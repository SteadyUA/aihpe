Как контролировать размер контекста (ответ на вопрос):
На данный момент система передает всю историю диалога для работы Prompt Caching. Если вы заметите (благодаря новым логам), что Capacity Used приближается к 100%, можно применить следующие стратегии (потребуют доработки кода):
*   Sliding Window: В ChatService.ts передавать в conversation только последние N сообщений.
*   Summarization: Периодически сворачивать старую историю в одно сообщение-саммари.
*   Filtering: Удалять старые вызовы инструментов (tool role) из истории, оставляя только текстовые сообщения, так как для контекста важен результат, а не промежуточные шаги (хотя это может ухудшить понимание моделью контекста правок).
